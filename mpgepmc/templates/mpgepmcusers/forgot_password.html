<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Forgot Password - MPGEPMC</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>.disabled{opacity:0.6; pointer-events:none}</style>
</head>
<body>
  <h1>Forgot Password</h1>

  {% if messages %}
    <ul>
      {% for m in messages %}
        <li style="color:red">{{ m }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <form method="post" id="forgot-form" action="{% url 'mpgepmcusers:forgot_password' %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" id="send-btn">Send Reset Link</button>
  </form>

  {% if token_remaining_seconds %}
    <p>A reset link was already sent. You must wait until it expires to request a new one.</p>
    <p id="reset-countdown"></p>
    <script>
      (function startCountdown(secs){
        function update(){
          if(secs <= 0){
            $("#reset-countdown").text("Previous reset link expired â€” you can request a new one now.");
            $("#send-btn").removeClass('disabled').prop('disabled', false);
            return;
          }
          let m = Math.floor(secs/60);
          let s = secs % 60;
          $("#reset-countdown").text(m + "m " + (s<10?"0":"") + s + "s remaining");
          secs -= 1;
          setTimeout(update, 1000);
        }
        $(function(){
          $("#send-btn").addClass('disabled').prop('disabled', true);
          update();
        });
      })({{ token_remaining_seconds }});
    </script>
  {% endif %}

  <p><a href="{% url 'mpgepmcusers:signin' %}">Back to sign in</a></p>
</body>
</html>
